---
created: '2025-12-03T20:01:54.744417'
id: 20251203T200154744397000
tags:
- variety
- architecture
- python
- gtk
- wallpaper
title: Variety Wallpaper Manager - Architecture Overview
type: permanent
updated: '2025-12-03T20:02:04.591693'
---

# Variety Wallpaper Manager - Architecture Overview

# Variety Wallpaper Manager Architecture

## Tech Stack
- **Language:** Python 3
- **GUI Framework:** GTK3/GObject (PyGObject)
- **Image Processing:** PIL/Pillow, ImageMagick (external)
- **IPC:** D-Bus for single-instance and CLI control
- **HTTP:** requests library
- **Config:** configobj for INI-style configuration

## Directory Structure
```
variety/              # Main application code
  ├── plugins/        # Plugin system
  │   ├── builtin/    # Built-in plugins
  │   │   ├── downloaders/   # Image sources (Unsplash, Wallhaven, Reddit, etc.)
  │   │   ├── quotes/        # Quote sources (Goodreads, Fortune, etc.)
  │   │   └── display_modes/ # Wallpaper display modes
  │   └── downloaders/       # Base classes for download plugins
  └── (dialogs, utilities, core)
variety_lib/          # Library helpers (dialogs, config, builders)
jumble/               # Plugin loader framework
data/                 # UI files (.ui), scripts, icons, config templates
tests/                # Unit tests
```

## Core Components

### 1. VarietyWindow (variety/VarietyWindow.py)
- Central controller, GTK main window
- 87 concepts - largest file, potential refactoring target
- Manages wallpaper rotation, downloads, quotes, thumbnails
- Coordinates all threads and events

### 2. Options (variety/Options.py)
- Configuration management
- Reads/writes ~/.config/variety/variety.conf
- Defines source types, filters, defaults

### 3. Plugin System
```
IVarietyPlugin (base)
  └── ImageSource
      ├── SimpleDownloader (for simple sources like APOD, Bing)
      └── ConfigurableImageSource → DefaultDownloader (for complex sources)
```

### 4. ThumbsManager/ThumbsWindow
- Thumbnail preview system
- Shows history, downloads, selector views

### 5. QuotesEngine
- Quote rotation and caching
- Supports multiple quote sources via plugins

## Design Patterns
1. **Observer** - Status updates across components
2. **Factory** - Downloader creation from source configs
3. **Strategy** - Different download/display strategies
4. **Builder** - UI construction patterns
5. **Command** - CLI command processing via D-Bus

## Entry Points
- `bin/variety` - CLI launcher script
- `variety/__init__.py` - D-Bus service, main() function
- `data/scripts/set_wallpaper` - External wallpaper setter script

## Key Extension Points
1. **New Image Sources:** Extend `SimpleDownloader` or `ConfigurableImageSource`
2. **New Quote Sources:** Implement `IQuoteSource`
3. **Display Modes:** Implement `IDisplayModesPlugin`
4. **Custom Scripts:** Modify `data/scripts/set_wallpaper`

## Links
- extends [[20251203T200154849937000]] Plugin system details extend architecture overview
- extends [[20251203T200154939556000]] Key files reference extends architecture overview